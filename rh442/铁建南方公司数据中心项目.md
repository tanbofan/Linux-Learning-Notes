[toc]

# 

# 1 项目背景

​		云计算是继个人计算机变革和互联网变革之后的第三次IT浪潮，也是中国战略性新兴产业的重要组成部分。云计算的出现并非偶然，早在上世纪60年代，麦卡锡就提出了把计算能力作为一种像水和电一样的公用事业提供给用户的理念，这成为云计算思想的起源。现在，云计算作为一种新兴的资源使用和交付模式逐渐为学界和产业界所认可。它意味着计算能力也可以作为一种商品进行流通，就像煤气、水电一样，取用方便，费用低廉。最大的不同在于，它是通过互联网进行传输的。

​		中国高铁作为国家世纪性战略工程，数据保密要求高、管理要求严。为满足中国铁路的建设要求，铁建南方公司规划建设新建武汉段数据中心（以下简称数据中心），主要承担施工建造全过程的软件服务应用的安全部署、数据存储和共享功能，拟通过VPN安全虚拟专用网络跨区域为公司、现场指挥部、设计单位、施工单位、监理单位等提供高效的传输、检索、查阅、协同办公等功能；数据中心将部署在公司独立的硬件和网络环境中，确保信息系统和技术资料的安全性、稳定性。

云计算为提高设备使用率，运维效率和实现资源的按需交付发挥了重要作用：

**提高数据中心资源的使用率，降低运维管理成本**

​		在传统数据中心建设模式，用户一般自行建设机房，导致大量硬件设备的利用率不高，各部门累计的运行维护费居高不下。如果建设统一的数据中心，根据各部门业务量统一采购服务器、交换机等硬件设备，统一进行运行维护，可以大大提高硬件设备的利用率，降低硬件设备的运行维护成本，并便于管理。通过引入虚拟化技术、云计算技术，可以使数据中心成为云计算中心。此外，以前每个单位的机房都要配备一定数量的人员，而采用基于云计算的统一机房建设模式，可以减少机房工作人员数量。许多大型数据中心已进入数据大集中阶段，云计算在建设统一机房或数据中心方面可以发挥其技术优势。

**加快业务部署速度，提高即时响应能力**

传统数据中心模式下，业务一般都是单机部署，如需上线新业务，需要重新采购服务器，部署网络，业务上线时间长达数天甚至数周。云数据中心能够对用户业务系统提出的建设需求做到快速响应、快速部署，部署更新工作只需几分钟即可完成。如果总资源池中硬件资源告急，只需要添加相应的物理服务器，简单的将新购置的服务器部署到资源池集群中，云数据中心会根据整体资源池的动态资源平衡策略来自动分配新增加的计算资源给应用程序，真正实现新服务器的即插即用。

**促进数据中心的信息安全建设**

传统数据中心的业务应用会面临网络威胁、恶意攻击、信息被恶意删除或篡改等问题，既然安全问题如此突出，云数据中心中会不会同样面临此问题，答案是云数据中心的安全性要高于传统数据中心模式。采用基于云计算技术的建设模式，可以促进信息安全从单部门的分散管理走向所有部门的集中管理。统一规划和配置网络安全软硬件设备及防火墙、防病毒等信息安全软件，而且降低保障信息安全所需成本。因此，反而是那些独立运维系统将面临更严峻的安全问题，一旦系统出现了安全问题后，恢复起来也更困难。

**实现数据中心的统一建设、统一管理、统一运维**

传统数据中心模式下，业务系统分散建设、分散管理、分散运维，暴露出很多问题，如重复建设、信息孤岛、高投入低效益等。采用基于云计算技术的模式，统一采购软硬件设备，对信息系统进行统一管理、统一运维，不但可以减少投入，而且便于信息资源整合，发挥云计算的整体效益。随着云计算技术的广泛应用，传统分散的数据中心管理体制已经不适应新形势，必须向集中管理方向发展。

# 2 建设目标

## 2.1 技术架构目标

采用超融合架构，实现融合一体化云平台，并为公有云和私有云互联提供安全保障；为关键业务、数据提供冗余备份机制

## 2.2 业务支撑目标

为传统生产业务及新型业务提供高可用、弹性扩展、高安全的IaaS平台，并为后期对接公用云，形成统一生产云平台提供基础支撑；为车机公电辆不同的业务需求提供足够的计算、存储、网络、安全资源保障。

## 2.3 运维管理目标

提供统一的运维监控平台，可以整合采集硬件状态、硬件使用情况、机房环境等信息，进行挖掘分析并能够进行展示告警，为运维人员提供辅助决策支持。

## 2.4 运营支撑目标

提供精细化的资源配额管理及资源计量管理。

## 2.5 网络安全目标

按照铁路行业等级保护2.0三级标准来整理规划设计，提供完善的安全防护及监测手段，基于安全态势感知技术，提供主动防御能力。

# 3 需求分析

​		全面推进铁路信息系统的电子化、智能化已成为当前的首要任务，建设铁建南方公司数据中心的必要性主要体现在以下几点：

**一是提高工作效率的迫切需要**

​		传统的数据传递方式、系统资源的管理手段等较为烦琐，已不能满足当前高效快节奏的工作需要，建设一套合理、高效的无线应用网络已经是当务之急。

**二是中国铁路信息化发展方向**

​		在参考包括铁路在内的国内外各行业信息化经验的基础上，原铁道部在2012年发布了《铁办〔2012〕101号》文件，规划了中国铁路信息化的几大发展方向如下：

​		建设高性能多业务承载网：“数据通信网资源应综合使用，除国家法律法规有明确规定的和国家有关部门有特殊要求的，原则上不再单独建设专网，现有各业务专网应逐步整合，提高网络利用效率和运行质量，避免网络资源浪费。”

​		IT资源大集中，降低边缘站点维护工作量：“为适应信息技术发展和信息系统运维工作特点，应积极推进计算机设备配置和部署集中化，最大限度地减少沿线和地区计算机设备，尽可能实行集中维护管理，减少基层站段维护工作量。”

## 3.1 总体需求分析

​		根据铁建南方公司的需求，为满足云数据中心的建设需求，需要考虑如下几个方面：

1. 通过云计算虚拟化技术，将现有的业务进行梳理，并做到资源集约化，能够提高资源的利用率；
2. 根据存储的现有容量以及未来增长需求，分别规划集中和分布式存储资源；
3. 根据当前公司的业务现状，结合下属子公司对资源的需求，对子公司进行租户的子网规划设计；
4. 根据等保三级标准，打造平台及的安全方案；
5. 满足资源集约化的统一管理，并能够对资源使用情况进行计量与计费，能够对平台下所有设备进行实时监控，提供高效的运维工具；
6. 对现有的部分业务进行迁移工作（需确认目前是否有业务）。

## 3.2 业务需求分析

​		考虑到未来可能的集团多个子公司及下属分支机构安全隔离及访问便利的需求，云平台中不同公司内部网络要实现完全隔离，在整体方案规划中需要为每个子公司创建VPC。

​		VPC（VPC（Virtual Private Cloud），其目的是让用户可以在云平台上构建出一个隔离的、自己能够管理配置和策略的虚拟网络环境，从而进一步提升用户在云平台环境中的资源的安全性。用户可以在VPC环境中管理自己的子网结构，IP地址范围和分配方式，网络的路由策略等。由于用户可以掌控并隔离VPC中的资源，因此对用户而言这就像是一个自己私有的[云计算](http://lib.csdn.net/base/hadoop)环境。

## 3.3 计算资源需求分析

​		云平台通过配置不同的driver，实现对虚拟化资源和物理资源的管理。基于虚拟化资源池，我们可以创建一台为自己“量身定制”的虚拟云主机；针对较繁忙事务类应用、关键业务应用，高并发等业务，如核心数据库系统，可依旧运行在物理主机。平台可以提供如下规格的虚拟云主机：

| 规格     | CPU（core） | 内存（GB） | 硬盘（GB） | 应用部署                                                     |
| :------- | :---------: | :--------: | :--------: | ------------------------------------------------------------ |
| 基础型   |      2      |     4      |    100     | 桌面级轻量级应用                                             |
| 标准型   |      4      |     8      |    100     | 一般事务类应用，少量用户的OA、邮件系统、应用服务器等         |
| 中性能   |      4      |     16     | 100/自定义 | 较繁忙事务类应用，大量用户数的OA、邮件系统、数据库、应用服务器等 |
| 高性能型 |      8      |     32     |    100     | 较繁忙事务类应用                                             |
| 网络型   |      8      |     16     |    100     | 提供网络服务，包括SDN，负载均衡，VPN                         |
| 混合型   |     16      |     32     |    300     | 较繁忙事物，存储吞吐性能要求高                               |

​		物理主机则依旧按照传统架构去建设，根据业务的不同需求，选择不同规格的服务器设备。

## 3.4 存储资源需求分析

​		在目前多数企业的存储环境中，以传统的SAN存储为主，存储容量基本能够满足现有需求，但是新增业务时则面临多种存储资源。

 虚拟化数据中心存储管理需要满足以下需求：

- 新增分布式存储技术，所有网络存储资源均可以被网络内的计算结点共享，当存储资源不足时，仅需要添加存储节点到存储网络中，所有的计算结点就能够快速的识别并使用新添加的存储空间，满足业务扩展需求。
- 提供多种存储资源，如块存储、对象存储和文件存储。满足新业务来临时对数据的存储需求。
- 原有集中式存储设备不变，可对数据库等实时性较高的业务应用提供存储能力，并能够通过平台将不同的存储设备进行统一管理。（如果有）

## 3.5网络资源需求分析

​		传统的核心、汇聚、接入通过VLAN实现租户的隔离，通过STP实现多路径保护；但传统二层网络中部署的STP生成树技术协议，部署和维护繁琐，网络规模不宜过大，限制了网络的扩展。

​		SDN技术是专门针对云计算环境数据中心建设而引入的技术，在业界知名的互联网数据中心中，以及公有云的建设中成为当前基础网络的首选技术，SDN是一种网络架构上叠加的虚拟化技术模式，其大体框架是对基础网络不进行大规模修改的条件下，实现应用在网络上的承载，并能与其它网络业务分离，并且以基于IP的基础网络技术为主。

​		从当前业界的应用情况来看，SDN技术可以满足对于多租户接入、多租户隔离、弹性扩展、大二层组网等需求，本次项目网络方案中建议采用SDN+Overlay技术实现整个基础网络的构建。

## 3.6 安全需求分析

​		云平台的基础安全保障，是云服务方所需承担的最基本、必须的义务。保护对象涵盖物理基础设施、服务器、网络和安全设备；虚拟化平台、资源池、云管平台，以及为租户提供的镜像、模板等。云平台的基础安全保障对象与保障措施图示，如下：

![img](./.assets/wpsDFCm77.jpg) 

### 3.6.1 云安全需求

​		在网络区域划分时，应参照国家相关指导标准规范，保障合规性；

​		在平台区域边界安全措施部署和保护时，应参照等级保护要求，达到相应能力要求；区域边界的深度防御，不仅要形成传统的多防线的纵深防护，还应在防御的网络层次上涵盖2~7层，抵抗进阶的攻防态势；

​		持续性安全检测，应对传统的只在网络入口部署IPS组件、边界异常流量清洗组件、核心网络交换机处部署IDS模式扩展、加强，将威胁检测能力下沉到虚拟化网络，并上升借助外围安全大数据分析的安全服务云，形成全面、深入、持续的安全检测能力，抵御不断升级的APT攻击和突发安全事件；

​		需对虚拟化平台、虚拟机等进行主机加固，保障计算环境安全；应对通信网络，部署多链路冗余和链路负载均衡措施，保障链路可用性，达到保障通信网络安全的目的；

​		安全响应和处置，应不仅限于传统的人工设置访问控制策略和事后审计，还应与安全管理中心联动，形成整体安全可视、自动化的快速安全策略升级响应，缩短攻击窗口、切断攻击扩散的链条，尽力减少损失；

### 3.6.2 云平台信息安全等级保护要求

​		云平台本身必须满足国家信息系统安全等级保护三级的要求。另外需按《信息系统安全等级保护定级指南》要求提供三级等保区域，提供给部分安全要求较高的业务系统使用。

## 3.7 平台功能需求分析

​		平台为了维护数据中心各种系统和应用的平稳、高效运行，云管理平台需要满足如下功能需求：

- 以服务目录的形式按需提供各种资源，用户通过统一的界面申请所需资源，包括虚拟机，物理机，存储服务，网络服务等等。
- 实现对数据中心的服务器、存储、网络等设备进行统一监控和管理，支持告警信息管理和性能管理，提供相关报表，保证数据中心的稳定运行。
- 实现异构虚拟化管理，支持目前主流虚拟化厂商的虚拟化平台。
- 支持多租户的划分与管理，将资源进行逻辑划分形成虚拟数据中心，并将其划分给不同的租户，租户可基于虚拟数据中心创建虚拟机。
- 支持对虚拟资源的生命周期管理，如创建/删除虚拟机，虚拟机的电源管理（开/关/重启/挂/恢复），开启虚拟机控制台，迁移虚拟机，虚拟机快照，虚拟机资源调整等等。
- 提供可视化管理，包括但不限于统一拓扑图、3D机房建模，提供一个直观的界面呈现全系统的所有资源信息，支持对内设备的资产管理。
- 支持对用户的权限管理，包括用户的创建删除赋权解权等功能，并以此建立IT服务管理流程体系，实现资源的按需实时交付。
- 支持对资源的计量和计费，支持对集群以及对租户的计费折扣，帮助管理员明确资源流向，实现资源按需交付。
- 支持应用自动化部署，资源编排管理与自助化服务，提高整体运维效率。
- 平台内的物理主机、虚拟机和虚拟化层的安全加固。
- 提供开放的API接口，封装底层云资源的统一操作，便于上层管理平台统一调度管理。





# 4. 数据中心总体设计

## 4.1 设计原则

### 4.1.1 高可靠性

​		系统的稳定可靠是应用系统正常运行的关键保证，在设计中选用高可靠性的产品，合理设计整体架构，制订可靠的策略，保证平台整体具有故障自愈的能力。

### 4.1.2 技术先进性和实用性

​		本次信息化建设将长期支撑公司的业务发展，而网络和数据中心又是信息化业务的基础支撑平台，因此本项目的建设需要考虑后续的机会成本，采用主流的、先进的技术和产品，保证基础支撑平台3~5年内不会被淘汰，从而实现投资的保护。

### 4.1.3 兼容性

​		云平台基于OpenStack架构进行设计，提供开放式和标准化的API接口，可便捷和第三方系统对接，且能够统一管理公有云与私有云。应避免被单一厂商绑定，平台可兼容业界通用的服务器，主流的操作系统，第三方存储，虚拟化软件，以及应用程序。

### 4.1.4 可扩展性

​		根据未来信息节点的增长和变化，移动无线接入平台可以平滑地扩容和升级，在扩容和升级过程中基本无须对网络架构和现有设备进行调整。

### 4.1.5 高可用性

​		从物理设备、云平台再到业务均能够做到高可用设计，以消除单点故障。另外，平台可以支持大规模、分布式集群的管控能力。

### 4.1.6 安全性

​		遵循国家信息安全等级保护要求，规划和设计私有云平台的安全防护解决方案，保障主机安全、虚拟化安全、网络安全和数据安全。提供安全运维技术手段，实现对安全事件的快速响应和应急处置。

###  4.1.7 经济性

​		采用先进、合理、实用的技术方案，尽可能降低设备投资和运营投资等。

### 4.1.8 工具化

​		采用高效的工具进行安装部署、日志分析、资源监控和智能运维，多个维度提高运维运营的效率。能够积极吸纳业界先进成熟的科技成果，确保平台能力和应用能力与时俱进，以保证系统平台具有较长的生命力和扩展能力。

## 4.2 云平台方案架构设计

​		平台方案架构主要设计了管理节点区域、计算资源池包括虚拟资源和物理资源、存储资源池包括集中存储和分布式存储、安全资源池等，具体如下图所示：

![img](./.assets/wpskDSbC7.png)

整体规划概述：

​	管理节点，用于OpenStack管理服务部署。网络节点用于OpenStack网络部署。计算节点提供虚拟主机服务。存储节点用于提供分布式存储服务。物理服务器在目前的规划中，暂时部署Oracle RAC数据库或其他重量级业务。

### 4.2.1 云平台系统架构

​		云管理平台是整体业务的资源提供平台，以模块化的设计理念，包含了服务器虚拟化、分布式存储、软件定义网络等功能组件，轻松实现用户对数据中心各类资源的统一管理，为上层云应用提供各种资源服务。提供一站式运维，便于用户维护，降低维护成本。

云管理平台系统架构如下图所示：（需要替换下图）

![image-20191219192221410](./.assets/image-20191219192221410.png)

​		云管理平台由云资源管理、云服务管理、云安全管理、私有云管理、业务管理、计费管理、智能监控、运维管理、系统管理九个功能模块组成，各功能组件采用松耦合、模块化设计，可自由组合，按需部署，降低IT采购成本，同时采用了可扩展性系统设计，便于增值模块开发，可满足用户个性化需求。

***云资源管理***：提供云基础设施管理与公有云管理。

***云服务管理***：对容器、大数据、虚拟卷、云数据库RDS版、云数据库MONGO版、云物理机、云盘、云桌面、云监控等云服务进行管理。

***云安全管理***：对服务器安全、基础安全、数据安全、运维安全进行管理。

***私有云管理***：对Openstack云控制中心、组织项目映射、虚拟机、网络与路由、卷、镜像、虚拟机类型的管理。

***业务管理***：可根据角色自定义资源申请审批流程。包括业务审批、流程管理、业务统计及通知设置。

***计费管理***: 实现对组织和最终租户的资源使用精确的计量计费。包括计量管理、计费设置、计费等级、组织账户账单、余额及充值等功能。

***智能监控***：主要包括对虚拟资源和物理资源的监控、数据收集、分析和告警功能。主要包括多视图资源监控、告警管理、3D机房、日志集中管理及相应告警系统配置。

***运维管理***：主要提供对数据中心服务器自动化功能与常用的运维管理，包括资产管理、软件仓库、故障管理、报表管理、服务器自动化、统一任务管理、运维配置。

系统管理：主要包括资源域管理、部门管理、组织管理、角色管理、用户管理、日志管理、任务管理及系统设置。

### 4.2.2 云平台资源池设计

#### 4.2.2.1 计算资源池设计

​		虚拟云主机具有单物理机所有功能，运行在隔离环境中的完整计算机系统。虚拟云主机功能实现主要包括但不限于如下内容:

1. 支持业务应用常用的操作系统，包括Windows和Linux。
2. 支持创建自定义CPU、内存和存储的云主机。
3. 支持对云主机生命周期进行管理，包括开启、关闭、删除、修改等。
4. 支持云主机的高可用。
5. 可以为虚拟云主机创建ssh密钥对。
6. 可以为虚拟云主机指定私有的网络、浮动IP、虚拟路由器、虚拟网络端口。
7. 提供云主机的快照和自定义镜像，支持对云主机生成快照，并提供分钟级别快照回滚功能。
8. 支持负载均衡策略。

服务器则是云平台的核心，其承担着平台内 “计算”功能。对于云平台中的服务器，通常都是将相同或者相似类型的服务器组合在一起，安装虚拟化软件，使其计算资源能以一种虚拟服务器的方式被不同的应用使用，即所谓的虚拟化资源池。虚拟化资源池应遵循以下原则：

1. 单个虚拟云服务器CPU、内存最大配置，不能超过物理计算资源集群中单台物理服务器的最大CPU、内存配置；
2. 单台物理服务器上所有云主机vCPU之和不超过物理机总核心的2倍；
3. 单台物理服务器上所有云主机内存之和不超过物理机内存的80%；
4. 考虑到HA及DRS所要求的资源冗余，以及业务高峰，所有运行虚机在正常负载下，总体资源使用率不应超过三分之二；
5. 一个物理服务器虚拟化集群中的物理服务器应是相同型号、相同配置；
6. 本地磁盘即内置磁盘的可用性及I/O吞吐能力均较弱，不建议在其上存放虚拟机，推荐使用外置高性能磁盘阵列。

为了保证云平台上虚拟机的可靠性，在发生服务器异常故障时，使得故障服务器上的虚拟机能在其它服务器通过云平台HA功能运行起来，尽量减少业务的中断时间。所以在系统部署时，代表系统计算资源的服务器CPU和内存资源要保留20%（按实际要求更改）的冗余。

#### 4.2.2.2 存储资源池设计

​		存储系统要能够为结构化数据、非结构化数据、大文件等各种类型数据分配适合的存储空间，能够向上层计算资源提供块存储、文件系统、以及面向对象存储等多种接口，能够纵向或横向扩展存储容量，能够实现磁盘卷（租户数据）的安全隔离，能够实现数据可靠性不低于99.999%。

​		本方案通过构建基于Ceph技术架构的分布式存储系统，将使用非融合部署架构，即存储节点独立部署，节点支持线性扩充。为云平台提供多样化的数据存储服务，实现存储资源的统一管理和使用。分布式存储示意图如下所示：

![img](./.assets/wpsgFYvPl.jpg)

#### 4.2.2.3 网络资源池设计

​		采用业界主流的“核心+接入”扁平化组网，核心交换机直接下联接入交换机，省去了中间汇聚层。随着网络交换技术的不断发展，交换机的端口接入密度越来越高，“扁平化”组网的扩展性和密度已经能够很好的数据中心服务器接入的要求。同时在服务器虚拟化技术应用越来越广泛的趋势下，扁平化二层架构更容易实现VLAN的大二层互通，满足虚拟机的部署和迁移。相比传统三层架构，扁平化二层架构可以大大简化网络的运维与管理。

​		通过SDN技术实现基础网络搭建，针对有虚拟化的主机，提供虚拟交换机实现虚机的接入，未做或不能做虚拟化的主机，通过L2层网关实现接入；为了简化SDN网络的部署，引入SDN控制器，实现SDN的流表学习和控制；为了更灵活地针对各虚机、业务、以及租户的安全控制，引入SDN的服务链的技术，通过L2网关实现接入安全资源池的接入。

 

![img](./.assets/wpsLyVaE8.jpg) 

该组网方案有以下优点：

- 适用于服务器虚拟化的场景，成本较低，VXLAN物理GW既可以用在核心位置，也可以在现有核心旁挂，保护已有投资。
- 控制面实现可以由高可靠的SDN Controller集群实现，提高了可靠性和可扩展性，避免了大规模的复杂部署。
- 网关组部署可以实现流量的负载分担和高可靠性传输。
- 支持分布式网关功能，使虚机迁移后不需要重新配置网关等网络参数，部署简单、灵活。



#### 4.2.2.4 安全资源池设计

​		私有云平台在安全建设方面由于IaaS层池化及云管理平台统一监管问题导致网络及IT资源的安全边界模糊，防护手段复杂且难以界定。因此，本次方案对私有云平台进行安全资源池建设，从池化角度出发，融合安全软、硬件，虚拟化安全资源池，实现安全策略和防护方式的动态调整和弹性扩展。因此，方案设计分别从南北向、东西向和带外管理三个维度进行安全建设；以边界安全、计算安全、运维安全、应运安全、自主可控等多个视角，为私有云平台提供多方位、多角度的安全防护措施。

​		本次方案设计从南北向、东西向、带外管理安全三个防护维度出发，对私有云平台的安全资源池进行总体架构设计，结合边界安全、计算安全、运维安全、应运安全、自主可控等多个视角，向整个私有云平台提供安全防护资源。安全架构如下图所示：

![img](./.assets/wpsmzjTuX.jpg) 

​		南北向安全资源池主要针对私有云平台的信息交互而设计。从平台内部来看，主要针对XXXX之间的信息交互；南北向安全资源池包括硬件安全资源（高性能硬件设备）和软件池形式，以边界安全为主要视角，向各区域提供安全防护资源。

​		东西向安全资源池主要针对XXXX的虚拟化层面的横向信息流量进行防护，实现虚拟机安全隔离（访问控制）、镜像与快照安全以及Hypervisor层强制访问控制等功能。东西向安全资源池包括虚拟化或云平台自身安全功能组件或第三方功能组件形式，以设备和计算安全为主要视角，向各区域提供安全防护资源。

​		带外管理安全资源池建设主要面向全网范围内的运维管理工作，通过统一运维管控平台实现对其他各资源池及网络、服务器设备的运维工作的安全管控和审计工作。带外管理安全资源池包括硬件资源和软件池形式，以监管与运维安全为主要视角，为全网提供安全监管资源。

### 4.2.3 云平台可靠性设计

​		云管理平台整体高可用架构设计如下图所示：

![img](./.assets/wpsSi0k76.png) 

​		云平台底层基于计算存储融合的x86服务器以及网络交换设备的部署，通过虚拟化技术整合，基于超融合架构，实现计算资源池、存储资源池和网络资源池构建。超融合技术将x86服务器的本地存储资源汇集成统一的存储资源池，通过网络路径冗余、网络分平面设计、存储多副本、小IO聚合、自动负载均衡等高可用技术实现高可靠的云计算资源池建设。上层通过云资源管理平台建设实现用户管理、运维和运营管理、开发管理、安全管理、日志管理以及计费管理等功能。通过云平台提供的虚拟机或容器以支撑上层业务系统相关模块的部署和运行。

### 4.2.4 云平台运营管理

#### 4.2.4.1 资源按需交付

​		私有云平台将用户的IT基础设施（如：服务器、共享存储）进行统一管控、形成资源池，由云数据中心管理平台的调度系统统一协调。

​		系统管理员在云平台启用服务后，组织管理员或组织用户即可登录云平台，在自己的界面上申请使用系统管理员所发布的服务。

​		组织管理员或组织用户在云平台自己的界面上可以看到已发布的服务列表，通过申请开通服务后，即可创建自己的服务实例，并可对所拥有的服务实例进行管理 。

#### 4.2.4.2 资源弹性伸缩

​		私有云平台将虚拟计算资源分布按一定的方式自动分布于物理资源上，完成云计算环境下的计算资源整合，实现资源池的动态伸缩。在资源池的基础上，私有云平台可将服务器物理资源转换成池化的可动态分配的计算单元，从各种业务的具体需求出发，在资源池中划分出适合具体业务需要的服务计算单元，不再受限于物理上的界限，并且可在存储和网络资源间更均匀地平衡 I/O 负载，从而提高资源的利用率，简化系统管理，让系统对业务需求的变化更具适应力。资源弹性伸缩根据使用目的不同，可分为资源调度、可用性保障。

​		动态资源调度：完善的调度策略与学习机制，自动发现与应用虚拟资源和物理资源间的关联关系；根据物理资源的负载、性能度、业务关联度等指标，在业务不中断的前提下增加或减少物理资源，并自动调整虚拟资源在物理资源上的分布，实现负载均衡。

​		私有云平台以负载均衡器为基础，将相同业务组合起来定义为弹性节点池。基于后台定时监控程序，当检测到业务的负载（平均CPU、平均内存、平均连接数）持续大于设定阈值时，自动将关闭的虚拟机开机，实现业务的负载均衡，防止业务卡顿或宕机。当检测到负载持续小于设定阈值时，自动关闭空闲虚拟机，节省系统资源。

业务连续性保障：自动发现设备异常、人为误操作、周围环境变化等信息，基于资源冗余思想和虚拟机迁移技术进行必要的HA、容错处理，使系统具有极高的可靠性。

![img](./.assets/wpsVMgyYb.jpg)

#### 4.2.4.3 用户管理体系

用户管理体系使各个用户职责权限清晰分明，系统功能划分简洁高效，系统管理员把有限的权限下放给组织管理员，使其可更好的维护管理基础设施，避免因繁琐的用户资源申请导致的云平台服务效率低下。

系统管理员侧重基础设施层面的物理资源管理与整合，组织管理员侧重虚拟VDC，虚拟网络，虚拟存储层面上的虚拟资源管理与整合，向系统管理员申请虚拟资源映射的物理资源，并负责根据用户申请分配虚拟资源。

普通用户侧重于通过自助服务门户按需索取资源的功能。

![img](./.assets/wps2ZKgkG.jpg) 

​		用户是角色和权限的载体。通过为用户设定角色，赋予用户一定的权限，以满足不同用户对系统的访问控制需求。用户管理需要具备用户的禁用和启用、用户授权、添加、删除、重置密码等。

​		云数据中心管理平台通过部门实现了资源与人员的分离管理，不同部门的人员可以归属于同一个组织、项目，区别于通过组织、项目进行虚拟VDC、虚拟网络、虚拟存储等虚拟资源管理与整合，使用户管理更加灵活。

​		项目功能与组织功能相似，但具备更加灵活的由下而上的管理方式。可以由普通用户向管理员进行申请，当申请通过后，用户便具备了项目的管理员权限，可以根据需要，将相关人员加入项目，并与组织管理员一样，进行资源的分配与管理，普通用户也可以灵活的退出项目，当项目使用周期结束后，用户也可以在租户端解散该项目。

​		角色规划方面，建议创建超级管理员实现对全局资源的统一管理。不同的资源域各规划一个域管理员，对其所属资源域具有最高的管理权限。组织管理员和组织用户可按照公司具体的部门情况进行划分，组织管理员与虚拟数据中心的对应可以是非常灵活的，根据具体的需要，一个部门的组织管理员可以管理多个业务系统的虚拟数据中心，也可以设置多个组织管理员进行分权管理。

#### 4.2.4.4 业务流程与审批

​		资源的交付分两组情况，一种是由高级管理员向低级租户直接分配资源，例如超级管理员/域管理员对组织管理员，组织管理员对组织用户，另一种即通过业务流程审批来获取资源。

​		云数据中心管理平台把现有的组织、角色等信息进行集成，实现业务资源的申请审批流程，可以自定义和配置审批流程涉及的参与角色、审批环节和处理逻辑，实现业务流程的自定义化处理，高效的集成在云资源管理平台中，使资源能够更加合理的被分配，保证资源分配的有效性与及时性，使运维管理更加方便。

#### 4.2.4.5 资源计量计费

​		对资源的计量计费有助于明确各个部门的资源利用率和流向。云数据中心管理平台可以定义数据中心计量策略，如按照CPU、内存和磁盘的使用量进行计量，并设定不同的计费策略，每个组织或用户可以清晰的查看资源使用情况。

​		计费管理采用即付即用的计费策略模型，即使用多少计算多少的方式对租户使用的云资源进行计费，根据筛选的计费信息，资源单价、折扣率等计算租户使用的云资源账单，及时出账，以方便租户账单查询。

计量计费功能包括但不限于

- 对主要资源（CPU/内存/硬盘/网卡）和服务（云主机，云物理机等等）设置计费单价（小时级别的资源计费）
- 对不同的资源池，不同的部门组织设置计费折扣
- 租户余额充值，余额欠费提醒，余额到期设置
- 计量计费账单管理，支持报表导出

### 4.2.5 云平台运维管理

#### 4.2.5.1 统一服务门户

​		私有云平台提供面向云租户和管理员的统一接入门户，通过界面集成、数据集成及功能集成等技术将各个子系统中的功能和信息有效组织起来，提供统一的信息服务功能入口，提供用户、授权、认证管理，并根据需求定制开发各种呈现内容。

​		不同的用户在完成登录认证后，根据其角色、权限等展示不同的个性化界面。

1) 面向租户：可基于门户实现自服务的功能。主要包括资源申请、进度查询、资源管理、计量计费、策略管理、账户信息、操作日志、角色管理、权限管理、统计报表、公共查看等功能。其中对资源的管理可实现对所属资源的实时展现、资源查询、资源集中告警、资源配置、统计报表等功能。

2) 面向管理员：主要是完成对全局情况的查看和角色权限内的流程审核、资源管理、服务管理、用户管理等功能。

​		门户对信息的展示应优先使用图形化界面结合表格的方式并支持导出，功能展示分区合理，兼容各类主流的浏览器。

#### 4.2.5.2 资源可视化管理

​		云数据中心的资源主要包含虚拟资源和物理资源。虚拟资源管理主要是对虚拟化资源池的管理，具体包括虚拟控制中心管理、虚拟数据中心管理、集群管理、主机管理、虚拟机管理、网络资源管理和存储资源管理。物理资源管理主要包括对物理机，小型机，存储设备，网络设备等物理设备的管理。

​		云平台可以按照资源分组和资源类型对数据中心内资源的性能监测数据进行分析和呈现，以图形化的形式展示资源实时性能情况及历史性能情况，支持单个资源的详细性能信息定制展示。

#### 4.2.5.3 异构虚拟化管理

​		云运维平台支持多种虚拟化平台，并具有扩展性。用户可以根据自己的需求，自定义选择适应自己的虚拟化平台。可以对不同的虚拟化平台进行统一的管理。

![img](/Users/tanbofan/Documents/markdown/.assets/wpsGPTIQa.jpg) 

​		云平台可以实现对异构虚拟化资源，例如VMware vSphere和OpenStack环境的纳管。同时支持相关的虚拟化功能，并为用户提供相关服务。



#### 4.2.5.4 服务可视化编排

​		服务编排的模型可以方便的进行复制，对于同类的服务，IT管理员仅需要使用旧有模型进行一定的修改即可，从而节省了大量的重复性工作。通过服务的自动编排，从而达到应用的自动快速部署。定义好的服务模型将成为后续进行编排的基本元素，接下来可以将这些个服务模型按照一定的排列方式进行组合编排，并根据需要设定具体的参数最终形成可使用的业务。

​		管理员可以通过可视化界面对基础设施进行管理，以实现平台内核组件及内置中间件的一键式安装部署、弹性扩容、故障恢复等；通过调用基础设施层接口、模板复制等方式实现，以降低管理大规模的数据中心集群的门槛。

![img](/Users/tanbofan/Documents/markdown/.assets/wpsgUepYH.jpg) 

​		具体在应用部署上，云平台把操作系统与应用软件进行松耦合操作，在操作系统层面实现代理程序，实现软件应用的灵活组合。企业级应用软件的安装也进行了改进，对于用户来说，申请虚拟机时，可连带需要的应用软件一同勾选，后续的应用软件安装对用户来说是透明的

​		通过操作系统平台与应用软件的解绑设计，使得同一操作系统类型的模板，只保留一个通用模板即可，维护上减少了工作量，并且释放了大量的存储空间。在通用模板里安装代理程序，使得该通用模板创建的虚拟机可以任意组合要安装的应用软件，相比传统的模板要更加的灵活。

#### 4.2.5.5 智能监控与分析预警

​		云数据中心内拥有众多不同厂商的软硬件，云平台通过提供全面、统一、多维度的管理监控子系统，管理监控数据中心中各类海量异构资源，包括服务器、存储、网络设备等硬件资源，各种操作系统、数据库、虚拟资源等软件资源；并且能够发现故障产生告警，有效提高响应速度，节省运维成本。

​		监控管理子系统可监控大规模数据中心，支持分布式部署，支持异构平台，提供丰富的监控项类型，包括：CPU使用率、CPU 负载、内存使用率、网络流量、磁盘空间使用率、进程状态、进程数等。支持对Linux/Unix服务器以及Windows服务器的监控。通过对监控数据的分析，对云资源管理平台的其他高级功能进行数据支持，进行负载均衡，有效保证应用的连续性及快速响应。总体架构如下图所示：

![img](/Users/tanbofan/Documents/markdown/.assets/wpsvQWwhW.jpg)

#### 4.2.5.6 自动化运维管理

私有云平台的自动化运维支持对批量节点进行远程操作、软件部署、配置管理等运维操作。主要特点如下：

- 作为管理基础设置的轻量级工具，容易搭建，并且可以批量管理服务器（保持秒级响应时间）；
- 可以执行任意命令，或者预定义的模块（复杂）命令。针对单独独立服务器，或者同名一组服务器，或者相同角色，系统硬件信息，操作系统，当前版本等等；
- 通过写简单的命令列表和属性，就可以将服务器配置为已知状态；
- 轻量级的配置管理系统，能够维持远端节点运行在预定状态（例如，确保指定的软件包 已经安装和特定的系统服务正在运行）；
- 分布式远程执行系统，用于在远端节点执行命令和查询数据，可以单独，也可以是选定条件。
- 自动化运维的功能包括：
- Linux操作系统的批量部署，包括代码的远程执行、文件分发、软件安装等。
- 软件自动化部署模板配置，将多个部署任务（远程代码、文件分发、软件安装等等）部署成一个部署模板
- 基于PXE的物理服务器操作系统的批量安装
- 物理服务器的硬件配置管理，包括批量bios升级，raid卡配置和BMC配置等等。
- 可以在任务列表里查看自动化运维的过程和结果

#### 4.2.5.7 日志和报表管理

​		管理员负责系统所有日志的审计管理工作，包括查询、清除、导出等功能；其他用户只能查看自身相关的日志数据，但不能执行其他操作。所有用户的所有操作，包括登录、退出、告警、操作等，都要记录在日志中；日志应包括事件类型、事件时间、操作者、操作对象、登录用户IP、日志级别、操作成功/失败、事件详细信息等字段。

​		云管平台能够记录所有相关管理员在云平台上的相关活动的日志，并对其进行审计。支持在海量日志中提取重要信息，并进行分析与告警，及时提示用户关注。同时，管理员可以通过数据转储功能对操作日志进行备份和删除。

#### 4.2.5.8 巡检管理

​		巡检是在机房正常使用的过程中对机房软硬件设施进行的定期或随机流动性的检验。目的是能及时发现机房使用过程中产生的问题。云平台巡检管理模块能够在资源智能监控的基础上，实现云数据中心资源的定期自动化巡检。系统允许用户自定义巡检报告，并根据用户指定的时间周期定期执行资源巡检任务，将巡检结果自动生成巡检报告并自动发送给相应的运维人员。大大提高巡检效率的同时为用户节省了大量的时间、人力成本。

![image-20191219230919704](/Users/tanbofan/Documents/markdown/.assets/image-20191219230919704.png)

### 4.2.6 大数据平台设计

#### 4.2.6.1 离线处理平台

离线处理，通常是指对海量数据进分析和处理，形成结果数据，供下一步数据应用使用的场景。离线处理对处理时间要求不高，但是所处理数据量较大，占用计算存储资源较多，通常通过MR或者Spark作业或者SQL作业实现。

离线处理场景的典型特点和核心诉求是：

1. 集群规模最大能力——数据量大，用户数据量最大超过5PB，大于1000节点
2. 数据权限和资源隔离（多租户）——多种离线处理作业同时运行，需要不同的数据权限和资源调度，避免越权访问和抢占资源
3. 接口与开源兼容——客户通常存在存量离线处理应用，需要迁移到Hadoop平台
4. 支持多数据源，多种数据加载方式——数据源存放在多种类型来源，存在多种类型数据，存在多种数据格式
5. 滚动升级——离线处理是客户大数据系统的基础，停机升级无法忍受
6. 支持作业调度管理——多种离线作业存在不同的优先级，不同的运行时间，需要多种调度策略管理，对异常、失败作业进行监控
7. 支持异构设备——支持异构设备，客户扩容时支持配置升级的设备，并且支持新旧设备区分使用
8. 支持冷热数据分级存储——用户数据热度不同，希望有分级存储策略，达到性能和成本的平衡
9. 支持与第三方软件对接（可视化、分析挖掘、报表、元数据等）——对接多种第三方工具，方便进行数据进一步的分析和管理

![img](./.assets/wpsV863g8.png)



#### 4.2.6.2 实施流处理平台

​		实时流处理，通常是指对实时数据源进行快速分析，迅速触发下一步动作的场景。实时流处理业务，对分析处理速度要求极高，数据处理规模巨大，对CPU和内存要求很高，但是通常数据不落地，对存储量要求不高。实时数据平台专门用来承载实时流处理业务。

![img](./.assets/wpsoHylyZ.jpg)

数据源：主要包含业务数据库以及Socket数据流和实时文件等。

实时数据采集：用于实时采集数据源产生的数据，并将其写入分布式消息系统，采集的数据格式包括文件、数据库、网络数据流等。

Flume：Hadoop自带的采集工具，支持多种格式的数据源，包括日志文件、网络数据流等。

第三方采集工具：第三方的专用实时数据采集工具，包括GoldenGate（数据库实时采集）、自开发采集程序（定制化采集工具）等。

消息中间件：消息中间件可对实时数据进行缓存，支持高吞吐量的消息订阅和发布。

Kafka：分布式消息系统，支持消息的生产和发布，以及多种形式的消息缓存，满足高效可靠的消息生产和消费。

分布式流计算引擎：对实时数据进行快速分析。

SparkStreaming：基于Spark的流处理引擎，支持秒以内的流处理分析。

Flink：新一代流处理引擎，支持毫秒级的流处理分析。



#### 4.2.6.3 实施检索平台

​		实时检索，通常是指数据实时写入，对海量数据基于索引主键实时查询，查询响应要求较高，查询条件相对比较简单。查询条件复杂的可以根据关键词在全域数据中通过索引搜索主键后，通过主键查询。全域数据既包含了结构化数据又包含了文本数据。 

例如：按照卡口和时间为主键快速查询过车数据，按照车辆为主键查询车辆轨迹数据。 

![img](./.assets/wpsA7zZMT.jpg)





# 5. 设备清单

| 序号 | 设备名称           | 数量 |
| ---- | ------------------ | ---- |
| 1    | 核心交换机         |      |
| 2    | 汇聚交换机         |      |
| 3    | spine节点交换机    |      |
| 4    | leaf节点交换机     |      |
| 5    | 带外管理交换机     |      |
| 6    | SDN控制器          |      |
| 7    | 虚拟化服务器       |      |
| 8    | 数据库服务器       |      |
| 9    | 大数据服务器       |      |
| 10   | 数据仓库服务器     |      |
| 11   | 集中式存储         |      |
| 12   | 存储交换机         |      |
| 13   | 云平台软件         |      |
| 14   | 分布式存储软件     |      |
| 15   | 大数据平台软件     |      |
| 16   | 抗DDoS设备         |      |
| 17   | 沙箱               |      |
| 18   | 边界防火墙         |      |
| 19   | 内外网安全隔离平台 |      |
| 20   | 漏洞扫描           |      |
| 21   | 日志审计           |      |
| 22   | 堡垒机             |      |
| 23   | 态势感知平台       |      |
| 24   | 防火墙             |      |
| 25   | 负载均衡           |      |
| 26   | VPN安全网关        |      |
| 27   | 上网行为管理       |      |
| 28   | 威胁探针           |      |
| 29   | 数据库审计         |      |
| 30   | 下一代防病毒系统   |      |